---
output: 
  html_document
css: styles.css
runtime: shiny
---

# Seagrass transect training {.tabset}
  
```{r setup, message = F, warning = F, results = 'hide', echo = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F, echo = F, fig.path = 'figs/', dev.args = list(family = 'serif'), fig.path = 'figures/')

library(tidyverse)
# library(seagrasstransect)
devtools::load_all('.')
library(shiny)

# get data and format
trnjsn <- read_trnjsn()
dat <- form_trnjsn(trnjsn)

# get choices for selection
sppopt <- unique(dat$Savspecies)

# # style file
# styles <- readLines('https://raw.githubusercontent.com/tbep-tech/css-styling/master/styles.css')
# writeLines(styles, 'styles.css')
```


```{r}
column(12, 
  column(3, selectInput('sppsel', 'Select species:', choices = sppopt)),
  column(3,
    renderUI({
         
      # inputs
      sppsel <- input$sppsel
         
      tosel <- dat %>% 
        filter(Savspecies %in% sppsel) %>% 
        pull(Transect) %>% 
        unique
      
      selectInput('trnsel', 'Select transect:', choices = tosel)
         
      })
  ), 
  column(3,
    renderUI({
      
      # inputs
      sppsel <- input$sppsel
      trnsel <- input$trnsel
      
      req(trnsel)

      tosel <- dat %>% 
        filter(Savspecies %in% sppsel) %>% 
        filter(Transect %in% trnsel) %>% 
        pull(Site) %>% 
        unique
      
      selectInput('sitsel', 'Select site:', choices = tosel)
      
    })
  ),
  column(3, 
    renderUI({
      
      # inputs
      sppsel <- input$sppsel
      trnsel <- input$trnsel
      sitsel <- input$sitsel
      
      req(sitsel)
  

      tosel <- dat %>% 
        filter(Savspecies %in% sppsel) %>% 
        filter(Transect %in% trnsel) %>% 
        filter(Site %in% sitsel) %>% 
        pull(var) %>%  
        unique
      
      selectInput('varsel', 'Select variable:', choices =  tosel)
            
    })     
  )

)
```

```{r reactives}
plodat <- reactive({
  
  # inputs
  sppsel <- input$sppsel
  trnsel <- input$trnsel
  sitsel <- input$sitsel
  varsel <- input$varsel
  
  req(varsel)
  
  out <- show_compplot(dat, trnsel, sitsel, sppsel, varsel, base_size = 14)
  
  return(out)
  
})
```

```{r}
output$plo <- renderPlot(plodat())
plotOutput('plo')
```

